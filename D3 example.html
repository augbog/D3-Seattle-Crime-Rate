<!doctype html>
<html lang="en">
<head>
	<style>
	.Maps {
		width: 504;
		height: 720;
		top: 0px;
		left: 0px;
		position: absolute;
	}

	.Maps#BeatsMap {
		z-index : 2;
	}

	#checkboxes {
		left: 0px;
		position: absolute;
		z-index: 3;
	}
	body {
		width: 100%;
		height: 100%;
	}
	</style>
	<meta charset="UTF-8">
	<title>D3 Seattle Crime Rate</title>
</head>
<script src="scripts/d3.min.js"></script>
<script src = "http://code.jquery.com/jquery-2.1.1.js"> </script>
	
<!-- <script src="http://d3js.org/d3.v3.min.js"></script>  -->
<!-- Include this if we want to use TopoJSON -->
<!-- <script src="http://d3js.org/topojson.v1.min.js"></script> -->	
<body>
	<div id = "checkboxes"> 
		<input type = "checkbox" name = "allCrime"> All Crime <br>
		<input type = "checkbox" name = "drug"> Violent Crime <br>
		<input type = "checkbox" name = "non-theftPropertyCrime"> Non-Theft Property Crime <br>
		<input type = "checkbox" name = "publicDisturbance"> Public Disturbance <br>
		<input type = "checkbox" name = "theft"> Theft <br>
		<input type = "checkbox" name = "traffic"> Traffic <br>
		<input type = "checkbox" name = "vice"> Vice <br>
		<input type = "checkbox" name = "white-collarCrime"> White-Collar Crime <br>
		<input type = "checkbox" name = "violentCrime"> Violent Crime <br>
		<input type = "checkbox" name = "other"> Other <br>
	</div>
	<div class = "Maps" id = "BeatsMap"> </div>
	<div class = "Maps" id = "allCrimeMap"> </div>
	<div class = "Maps" id = "drugMap"> </div>
	<div class = "Maps" id = "non-theftPropertyCrimeMap"> </div>
	<div class = "Maps" id = "publicDisturbanceMap"> </div>
	<div class = "Maps" id = "theftMap"> </div>
	<div class = "Maps" id = "trafficMap"> </div>
	<div class = "Maps" id = "viceMap"> </div>
	<div class = "Maps" id = "white-collarCrimeMap"> </div>
	<div class = "Maps" id = "violentCrimeMap"> </div>
	<div class = "Maps" id = "otherMap"> </div>
		<script> 
			d3.selection.prototype.moveToFront = function() {
				return this.each(function() {
					this.parentNode.appendChild(this);
				});
			};

			//load the beats outline.  This is the element which specifies path
			d3.xml("Beats.svg", "image/svg+xml", function(xml) {
				var importedNode = document.importNode(xml.documentElement, true);
				//put it into the div for it
				d3.select("#BeatsMap").node().appendChild(importedNode);

				//assign event functions
				var mouseX = null;
				var mouseY = null;
				var graphExists = false;
				//hover with wait function
				//so it appears where your curser is, not where you go into the path
				$('path').mousemove(function(e) {
			   			mouseX = e.pageX;
			   			mouseY = e.pageY;
						})
				//creats/moves the actual div with graphs
						.mouseover(function(e) {
						$this = $(this);
			   			//creats a wait
			   			$this.data("delay", setTimeout( function () {
			   			if(mouseX == null || mouseY == null) {
			   				mouseX = e.pageX;
			   				mouseY = e.pageY;
			   			}
			   			console.log("This is...");
			   			console.log($this);

			   			console.log("e is...")
			   			console.log(e);
			   			if(graphExists) {
			   				graphs = d3.select("#graphs")
			   				graphs.text("This will be a graph of Beat " + $this[0].id)
			   					.style("left", mouseX +"px")
				   				.style("top", mouseY +"px");
			   			} else {
				   			graphs = d3.select("body").append("div")
				   			graphs.text("This will be a map of Beat " + $this[0].id)
				   				.attr("id", "graphs")
				   				.style("position", "absolute")
				   				.style("left", mouseX +"px")
				   				.style("top", mouseY +"px")
				   				.style("background-color", "red")
				   				.style("z-index", 3);
				   			graphExists = true;
				   		}
			    	}, 1000));
			   		//if you're just passing through, does nothing.
					}).mouseleave(function () {
					    $this = $(this);
					    clearTimeout($this.data("delay"));
					});
					//.click function will go here

					//removes the hover graph when you're not on the map
					$(document).mousemove(function(e) {
						documentThis = $(this);
						var timer = documentThis.data("delay", setTimeout(function() {

							paths = $('path')
							graphDiv = $('#graphs')
							if (!paths.is(e.target) && !graphDiv.is(e.target)) {
								if (graphExists) {
									d3.select("#graphs").remove();
									graphExists = false;
								}
							}
						}, 1000));
					}).mousemove(function(e) {
						documentThis = $(this)
						clearTimeout(documentThis.data("delay"))
						documentThis.data("delay", setTimeout(function() {

							paths = $('path')
							graphDiv = $('#graphs')
							if (!paths.is(e.target) && !graphDiv.is(e.target)) {
								if (graphExists) {
									d3.select("#graphs").remove();
									graphExists = false;
								}
							}
						}, 1000));
					})
					
			});

			//get rid of graphs if you hover outside of a path

	
			//remembers which maps are already loaded
			var maps = {};
			

			//makes checkboxes into toggle functions
			$('input[type=checkbox]').click(function() {

				var currName = this.name;
	    		var svgName = this.name.concat(".svg");
	    		//loads the file if unloaded
	    		if(!maps.hasOwnProperty(svgName)) {

	    			d3.xml(svgName, "image/svg+xml", function(xml) {
					var importedNode = document.importNode(xml.documentElement, true);

					maps[svgName] = importedNode;
					
					var svgSelect = "#" + currName + "Map";

					d3.select(svgSelect).node().appendChild(importedNode);

					});
	    		//hides/makes visible if map is already loaded
	    		} else {
	    			if (maps[svgName].getAttribute("visibility") == "hidden") {
	    				maps[svgName].setAttribute("visibility", "visible");	
	    			} else {
	    				maps[svgName].setAttribute("visibility", "hidden");
	    			}
	    		}
			});
		</script>
	</body
</html>